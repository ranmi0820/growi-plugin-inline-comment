{"version":3,"file":"validate-growi-plugin-directive.js","sources":["../../../../../src/v4/server/utils/theme/validate-growi-plugin-directive.ts"],"sourcesContent":["import type { GrowiThemeMetadata } from '@growi/core';\nimport { GrowiPluginType, isGrowiThemeMetadata } from '@growi/core';\n\nimport type {\n  GrowiPluginValidationData,\n  GrowiThemePluginValidationData,\n} from '../../../../model';\nimport { GrowiPluginValidationError } from '../../../../model';\nimport { validateGrowiDirective } from '../common';\n\n/**\n * An utility for theme plugin which wrap 'validateGrowiDirective' of './common' module\n * @param projectDirRoot\n */\nexport const validateThemePluginGrowiDirective = (\n  projectDirRoot: string,\n): GrowiThemePluginValidationData => {\n  const data = validateGrowiDirective(projectDirRoot, GrowiPluginType.Theme);\n\n  const { growiPlugin } = data;\n\n  // check themes\n  if (\n    growiPlugin.themes == null ||\n    !Array.isArray(growiPlugin.themes) ||\n    growiPlugin.themes.length === 0\n  ) {\n    throw new GrowiPluginValidationError<GrowiPluginValidationData>(\n      \"Theme plugin must have 'themes' array and that must have one or more theme metadata\",\n    );\n  }\n\n  const validMetadatas: GrowiThemeMetadata[] = [];\n  const invalidObjects: unknown[] = [];\n  for (const theme of growiPlugin.themes) {\n    if (isGrowiThemeMetadata(theme)) {\n      validMetadatas.push(theme);\n    } else {\n      invalidObjects.push(theme);\n    }\n  }\n\n  if (invalidObjects.length > 0) {\n    throw new GrowiPluginValidationError<GrowiPluginValidationData>(\n      `Some of theme metadata are invalid: ${invalidObjects.toString()}`,\n    );\n  }\n\n  return {\n    ...data,\n    themes: validMetadatas,\n  };\n};\n"],"names":["validateThemePluginGrowiDirective","projectDirRoot","data","validateGrowiDirective","GrowiPluginType","growiPlugin","GrowiPluginValidationError","validMetadatas","invalidObjects","theme","isGrowiThemeMetadata"],"mappings":";;;AAca,MAAAA,IAAoC,CAC/CC,MACmC;AACnC,QAAMC,IAAOC,EAAuBF,GAAgBG,EAAgB,KAAK,GAEnE,EAAE,aAAAC,MAAgBH;AAGxB,MACEG,EAAY,UAAU,QACtB,CAAC,MAAM,QAAQA,EAAY,MAAM,KACjCA,EAAY,OAAO,WAAW;AAE9B,UAAM,IAAIC;AAAA,MACR;AAAA,IACF;AAGF,QAAMC,IAAuC,CAAC,GACxCC,IAA4B,CAAC;AACxB,aAAAC,KAASJ,EAAY;AAC1B,IAAAK,EAAqBD,CAAK,IAC5BF,EAAe,KAAKE,CAAK,IAEzBD,EAAe,KAAKC,CAAK;AAIzB,MAAAD,EAAe,SAAS;AAC1B,UAAM,IAAIF;AAAA,MACR,uCAAuCE,EAAe,UAAU;AAAA,IAClE;AAGK,SAAA;AAAA,IACL,GAAGN;AAAA,IACH,QAAQK;AAAA,EACV;AACF;"}