{"version":3,"file":"validate-all-locales.js","sources":["../../../../../src/v4/server/utils/template/validate-all-locales.ts"],"sourcesContent":["import { scanAllTemplates } from './scan';\nimport { validateTemplatePluginGrowiDirective } from './validate-growi-plugin-directive';\n\nexport const validateAllTemplateLocales = async (\n  projectDirRoot: string,\n): Promise<boolean> => {\n  const data = validateTemplatePluginGrowiDirective(projectDirRoot);\n\n  const results = await scanAllTemplates(projectDirRoot, {\n    data,\n    returnsInvalidTemplates: true,\n  });\n\n  if (Object.keys(results).length === 0) {\n    throw new Error('This plugin does not have any templates');\n  }\n\n  // construct map\n  // key: id\n  // value: isValid properties\n  const idValidMap: { [id: string]: boolean[] } = {};\n  for (const summary of results) {\n    idValidMap[summary.default.id] = Object.values(summary).map(\n      (s) => s?.isValid ?? false,\n    );\n  }\n\n  for (const [id, validMap] of Object.entries(idValidMap)) {\n    // warn\n    if (!validMap.every((bool) => bool)) {\n      // eslint-disable-next-line no-console\n      console.warn(\n        `[WARN] Template '${id}' has some locales that status is invalid`,\n      );\n    }\n\n    // This means the template directory does not have any valid template\n    if (!validMap.some((bool) => bool)) {\n      return false;\n    }\n  }\n\n  return true;\n};\n"],"names":["validateAllTemplateLocales","projectDirRoot","data","validateTemplatePluginGrowiDirective","results","scanAllTemplates","idValidMap","summary","s","id","validMap","bool"],"mappings":";;AAGa,MAAAA,IAA6B,OACxCC,MACqB;AACf,QAAAC,IAAOC,EAAqCF,CAAc,GAE1DG,IAAU,MAAMC,EAAiBJ,GAAgB;AAAA,IACrD,MAAAC;AAAA,IACA,yBAAyB;AAAA,EAAA,CAC1B;AAED,MAAI,OAAO,KAAKE,CAAO,EAAE,WAAW;AAC5B,UAAA,IAAI,MAAM,yCAAyC;AAM3D,QAAME,IAA0C,CAAC;AACjD,aAAWC,KAAWH;AACpB,IAAAE,EAAWC,EAAQ,QAAQ,EAAE,IAAI,OAAO,OAAOA,CAAO,EAAE;AAAA,MACtD,CAACC,OAAMA,KAAA,gBAAAA,EAAG,YAAW;AAAA,IACvB;AAGF,aAAW,CAACC,GAAIC,CAAQ,KAAK,OAAO,QAAQJ,CAAU;AAUpD,QARKI,EAAS,MAAM,CAACC,MAASA,CAAI,KAExB,QAAA;AAAA,MACN,oBAAoBF,CAAE;AAAA,IACxB,GAIE,CAACC,EAAS,KAAK,CAACC,MAASA,CAAI;AACxB,aAAA;AAIJ,SAAA;AACT;"}