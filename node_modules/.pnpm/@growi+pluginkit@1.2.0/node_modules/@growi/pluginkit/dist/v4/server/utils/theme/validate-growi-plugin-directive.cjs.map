{"version":3,"file":"validate-growi-plugin-directive.cjs","sources":["../../../../../src/v4/server/utils/theme/validate-growi-plugin-directive.ts"],"sourcesContent":["import type { GrowiThemeMetadata } from '@growi/core';\nimport { GrowiPluginType, isGrowiThemeMetadata } from '@growi/core';\n\nimport type {\n  GrowiPluginValidationData,\n  GrowiThemePluginValidationData,\n} from '../../../../model';\nimport { GrowiPluginValidationError } from '../../../../model';\nimport { validateGrowiDirective } from '../common';\n\n/**\n * An utility for theme plugin which wrap 'validateGrowiDirective' of './common' module\n * @param projectDirRoot\n */\nexport const validateThemePluginGrowiDirective = (\n  projectDirRoot: string,\n): GrowiThemePluginValidationData => {\n  const data = validateGrowiDirective(projectDirRoot, GrowiPluginType.Theme);\n\n  const { growiPlugin } = data;\n\n  // check themes\n  if (\n    growiPlugin.themes == null ||\n    !Array.isArray(growiPlugin.themes) ||\n    growiPlugin.themes.length === 0\n  ) {\n    throw new GrowiPluginValidationError<GrowiPluginValidationData>(\n      \"Theme plugin must have 'themes' array and that must have one or more theme metadata\",\n    );\n  }\n\n  const validMetadatas: GrowiThemeMetadata[] = [];\n  const invalidObjects: unknown[] = [];\n  for (const theme of growiPlugin.themes) {\n    if (isGrowiThemeMetadata(theme)) {\n      validMetadatas.push(theme);\n    } else {\n      invalidObjects.push(theme);\n    }\n  }\n\n  if (invalidObjects.length > 0) {\n    throw new GrowiPluginValidationError<GrowiPluginValidationData>(\n      `Some of theme metadata are invalid: ${invalidObjects.toString()}`,\n    );\n  }\n\n  return {\n    ...data,\n    themes: validMetadatas,\n  };\n};\n"],"names":["validateThemePluginGrowiDirective","projectDirRoot","data","validateGrowiDirective","GrowiPluginType","growiPlugin","GrowiPluginValidationError","validMetadatas","invalidObjects","theme","isGrowiThemeMetadata"],"mappings":"2OAcaA,EACXC,GACmC,CACnC,MAAMC,EAAOC,EAAA,uBAAuBF,EAAgBG,EAAAA,gBAAgB,KAAK,EAEnE,CAAE,YAAAC,GAAgBH,EAGxB,GACEG,EAAY,QAAU,MACtB,CAAC,MAAM,QAAQA,EAAY,MAAM,GACjCA,EAAY,OAAO,SAAW,EAE9B,MAAM,IAAIC,EAAA,2BACR,qFACF,EAGF,MAAMC,EAAuC,CAAC,EACxCC,EAA4B,CAAC,EACxB,UAAAC,KAASJ,EAAY,OAC1BK,EAAAA,qBAAqBD,CAAK,EAC5BF,EAAe,KAAKE,CAAK,EAEzBD,EAAe,KAAKC,CAAK,EAIzB,GAAAD,EAAe,OAAS,EAC1B,MAAM,IAAIF,EAAA,2BACR,uCAAuCE,EAAe,UAAU,EAClE,EAGK,MAAA,CACL,GAAGN,EACH,OAAQK,CACV,CACF"}