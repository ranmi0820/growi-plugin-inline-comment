"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const h=require("node:fs"),o=require("node:path"),w=require("../../../interfaces/template.cjs"),T=require("./get-status.cjs"),v=require("./validate-growi-plugin-directive.cjs"),f=async(a,e,c,i)=>{const l=[],d=o.resolve(a,"dist",e);let u=!1;for await(const n of c.supportingLocales){const r=o.resolve(d,n);try{const t=await T.getStatus(r),{isTemplateExists:m,meta:s}=t;if(!m)throw new Error("'template.md does not exist.");if(s==null)throw new Error("'meta.md does not exist.");if((s==null?void 0:s.title)==null)throw new Error("'meta.md does not contain the title.");const g=!u;l.push({pluginId:i==null?void 0:i.pluginId,id:e,locale:n,isValid:!0,isDefault:g,title:s.title,desc:s.desc}),u=!0}catch(t){l.push({pluginId:i==null?void 0:i.pluginId,id:e,locale:n,isValid:!1,invalidReason:t.message})}}return console.debug(`Template directory (${a}) has scanned`,{status:l}),l},y=async(a,e)=>{const c=(e==null?void 0:e.data)??v.validateTemplatePluginGrowiDirective(a),i=[],l=o.resolve(a,"dist"),d=h.readdirSync(l);for await(const u of d){const n=(await f(a,u,c,{pluginId:e==null?void 0:e.pluginId})).filter(t=>e!=null&&e.returnsInvalidTemplates?!0:t.isValid),r=n.find(t=>"isDefault"in t&&t.isDefault);r==null||!w.isTemplateStatusValid(r)||i.push({default:r,...Object.fromEntries(n.map(t=>[t.locale,t]))})}return i};exports.scanAllTemplates=y;exports.scanTemplate=f;
//# sourceMappingURL=scan.cjs.map
