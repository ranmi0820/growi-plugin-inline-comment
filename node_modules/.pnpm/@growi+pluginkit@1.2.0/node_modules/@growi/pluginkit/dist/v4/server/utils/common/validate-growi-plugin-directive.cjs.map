{"version":3,"file":"validate-growi-plugin-directive.cjs","sources":["../../../../../src/v4/server/utils/common/validate-growi-plugin-directive.ts"],"sourcesContent":["import type { GrowiPluginType } from '@growi/core';\n\nimport {\n  type GrowiPluginValidationData,\n  GrowiPluginValidationError,\n} from '../../../../model';\nimport { importPackageJson } from './import-package-json';\n\nexport const validateGrowiDirective = (\n  projectDirRoot: string,\n  expectedPluginType?: GrowiPluginType,\n): GrowiPluginValidationData => {\n  const pkg = importPackageJson(projectDirRoot);\n\n  const { growiPlugin } = pkg;\n\n  const data: GrowiPluginValidationData = {\n    projectDirRoot,\n    schemaVersion: Number.NaN,\n    growiPlugin,\n  };\n\n  if (growiPlugin == null) {\n    throw new GrowiPluginValidationError(\n      \"The package.json does not have 'growiPlugin' directive.\",\n      data,\n    );\n  }\n\n  // schema version checking\n  const schemaVersion = Number(growiPlugin.schemaVersion);\n  data.schemaVersion = schemaVersion;\n  if (Number.isNaN(schemaVersion) || schemaVersion < 4) {\n    throw new GrowiPluginValidationError(\n      \"The growiPlugin directive must have a valid 'schemaVersion' directive.\",\n      data,\n    );\n  }\n\n  const types: GrowiPluginType[] = growiPlugin.types;\n  data.actualPluginTypes = types;\n  if (types == null) {\n    throw new GrowiPluginValidationError(\n      \"The growiPlugin directive does not have 'types' directive.\",\n      data,\n    );\n  }\n\n  // type checking\n  if (expectedPluginType != null) {\n    data.expectedPluginType = expectedPluginType;\n\n    if (!types.includes(expectedPluginType)) {\n      throw new GrowiPluginValidationError(\n        \"The growiPlugin directive does not have expected plugin type in 'types' directive.\",\n        data,\n      );\n    }\n  }\n\n  return data;\n};\n"],"names":["validateGrowiDirective","projectDirRoot","expectedPluginType","pkg","importPackageJson","growiPlugin","data","GrowiPluginValidationError","schemaVersion","types"],"mappings":"8LAQaA,EAAyB,CACpCC,EACAC,IAC8B,CACxB,MAAAC,EAAMC,oBAAkBH,CAAc,EAEtC,CAAE,YAAAI,GAAgBF,EAElBG,EAAkC,CACtC,eAAAL,EACA,cAAe,OAAO,IACtB,YAAAI,CACF,EAEA,GAAIA,GAAe,KACjB,MAAM,IAAIE,EAAA,2BACR,0DACAD,CACF,EAII,MAAAE,EAAgB,OAAOH,EAAY,aAAa,EAEtD,GADAC,EAAK,cAAgBE,EACjB,OAAO,MAAMA,CAAa,GAAKA,EAAgB,EACjD,MAAM,IAAID,EAAA,2BACR,yEACAD,CACF,EAGF,MAAMG,EAA2BJ,EAAY,MAE7C,GADAC,EAAK,kBAAoBG,EACrBA,GAAS,KACX,MAAM,IAAIF,EAAA,2BACR,6DACAD,CACF,EAIF,GAAIJ,GAAsB,OACxBI,EAAK,mBAAqBJ,EAEtB,CAACO,EAAM,SAASP,CAAkB,GACpC,MAAM,IAAIK,EAAA,2BACR,qFACAD,CACF,EAIG,OAAAA,CACT"}