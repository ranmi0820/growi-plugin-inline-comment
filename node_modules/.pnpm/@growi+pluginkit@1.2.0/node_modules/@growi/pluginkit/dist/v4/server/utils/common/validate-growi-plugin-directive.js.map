{"version":3,"file":"validate-growi-plugin-directive.js","sources":["../../../../../src/v4/server/utils/common/validate-growi-plugin-directive.ts"],"sourcesContent":["import type { GrowiPluginType } from '@growi/core';\n\nimport {\n  type GrowiPluginValidationData,\n  GrowiPluginValidationError,\n} from '../../../../model';\nimport { importPackageJson } from './import-package-json';\n\nexport const validateGrowiDirective = (\n  projectDirRoot: string,\n  expectedPluginType?: GrowiPluginType,\n): GrowiPluginValidationData => {\n  const pkg = importPackageJson(projectDirRoot);\n\n  const { growiPlugin } = pkg;\n\n  const data: GrowiPluginValidationData = {\n    projectDirRoot,\n    schemaVersion: Number.NaN,\n    growiPlugin,\n  };\n\n  if (growiPlugin == null) {\n    throw new GrowiPluginValidationError(\n      \"The package.json does not have 'growiPlugin' directive.\",\n      data,\n    );\n  }\n\n  // schema version checking\n  const schemaVersion = Number(growiPlugin.schemaVersion);\n  data.schemaVersion = schemaVersion;\n  if (Number.isNaN(schemaVersion) || schemaVersion < 4) {\n    throw new GrowiPluginValidationError(\n      \"The growiPlugin directive must have a valid 'schemaVersion' directive.\",\n      data,\n    );\n  }\n\n  const types: GrowiPluginType[] = growiPlugin.types;\n  data.actualPluginTypes = types;\n  if (types == null) {\n    throw new GrowiPluginValidationError(\n      \"The growiPlugin directive does not have 'types' directive.\",\n      data,\n    );\n  }\n\n  // type checking\n  if (expectedPluginType != null) {\n    data.expectedPluginType = expectedPluginType;\n\n    if (!types.includes(expectedPluginType)) {\n      throw new GrowiPluginValidationError(\n        \"The growiPlugin directive does not have expected plugin type in 'types' directive.\",\n        data,\n      );\n    }\n  }\n\n  return data;\n};\n"],"names":["validateGrowiDirective","projectDirRoot","expectedPluginType","pkg","importPackageJson","growiPlugin","data","GrowiPluginValidationError","schemaVersion","types"],"mappings":";;AAQa,MAAAA,IAAyB,CACpCC,GACAC,MAC8B;AACxB,QAAAC,IAAMC,EAAkBH,CAAc,GAEtC,EAAE,aAAAI,MAAgBF,GAElBG,IAAkC;AAAA,IACtC,gBAAAL;AAAA,IACA,eAAe,OAAO;AAAA,IACtB,aAAAI;AAAA,EACF;AAEA,MAAIA,KAAe;AACjB,UAAM,IAAIE;AAAA,MACR;AAAA,MACAD;AAAA,IACF;AAII,QAAAE,IAAgB,OAAOH,EAAY,aAAa;AAEtD,MADAC,EAAK,gBAAgBE,GACjB,OAAO,MAAMA,CAAa,KAAKA,IAAgB;AACjD,UAAM,IAAID;AAAA,MACR;AAAA,MACAD;AAAA,IACF;AAGF,QAAMG,IAA2BJ,EAAY;AAE7C,MADAC,EAAK,oBAAoBG,GACrBA,KAAS;AACX,UAAM,IAAIF;AAAA,MACR;AAAA,MACAD;AAAA,IACF;AAIF,MAAIJ,KAAsB,SACxBI,EAAK,qBAAqBJ,GAEtB,CAACO,EAAM,SAASP,CAAkB;AACpC,UAAM,IAAIK;AAAA,MACR;AAAA,MACAD;AAAA,IACF;AAIG,SAAAA;AACT;"}