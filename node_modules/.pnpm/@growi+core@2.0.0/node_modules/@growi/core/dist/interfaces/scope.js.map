{"version":3,"file":"scope.js","sources":["../../src/interfaces/scope.ts"],"sourcesContent":["// SCOPE_SEED defines the basic scope structure.\n// When you need to set different permissions for Admin and User\n// on specific endpoints (like /me), use SCOPE rather than modifying SCOPE_SEED.\n\n// If you want to add a new scope, you only need to add a new key to the SCOPE_SEED object.\n\n// Change translation file contents (accesstoken_scopes_desc) when scope structure is modified\n\nconst SCOPE_SEED_ADMIN = {\n  admin: {\n    top: {},\n    app: {},\n    security: {},\n    markdown: {},\n    customize: {},\n    import_data: {},\n    export_data: {},\n    data_transfer: {},\n    external_notification: {},\n    slack_integration: {},\n    legacy_slack_integration: {},\n    user_management: {},\n    user_group_management: {},\n    audit_log: {},\n    plugin: {},\n    ai_integration: {},\n    full_text_search: {},\n  },\n} as const;\n\nconst SCOPE_SEED_USER = {\n  user_settings: {\n    info: {},\n    external_account: {},\n    password: {},\n    api: {\n      api_token: {},\n      access_token: {},\n    },\n    in_app_notification: {},\n    other: {},\n  },\n  features: {\n    ai_assistant: {},\n    page: {},\n    share_link: {},\n    bookmark: {},\n    attachment: {},\n    page_bulk_export: {},\n  },\n} as const;\n\nconst SCOPE_SEED = {\n  ...SCOPE_SEED_ADMIN,\n  ...SCOPE_SEED_USER,\n} as const;\n\nexport const ACTION = {\n  READ: 'read',\n  WRITE: 'write',\n} as const;\n\ntype ACTION_TYPE = (typeof ACTION)[keyof typeof ACTION];\nexport const ALL_SIGN = '*';\n\nconst SCOPE_SEED_WITH_ACTION = Object.values(ACTION).reduce(\n  (acc, action) => {\n    acc[action] = SCOPE_SEED;\n    return acc;\n  },\n  {} as Record<ACTION_TYPE, typeof SCOPE_SEED>,\n);\n\ntype FlattenObject<T> = {\n  [K in keyof T]: T[K] extends object\n    ? keyof T[K] extends never\n      ? K\n      : `${K & string}:${FlattenObject<T[K]> & string}`\n    : K;\n}[keyof T];\n\ntype AddAllToScope<S extends string> = S extends `${infer X}:${infer Y}`\n  ? `${X}:${typeof ALL_SIGN}` | `${X}:${AddAllToScope<Y>}` | S\n  : S;\n\ntype ScopeOnly = FlattenObject<typeof SCOPE_SEED_WITH_ACTION>;\ntype ScopeWithAll = AddAllToScope<ScopeOnly>;\nexport type Scope = ScopeOnly | ScopeWithAll;\n\n// ScopeConstants type definition\ntype ScopeConstantLeaf = Scope;\n\ntype ScopeConstantNode<T> = {\n  [K in keyof T as Uppercase<string & K>]: T[K] extends object\n    ? keyof T[K] extends never\n      ? ScopeConstantLeaf\n      : ScopeConstantNode<T[K]> & { ALL: Scope }\n    : ScopeConstantLeaf;\n};\n\ntype ScopeConstantType = {\n  [A in keyof typeof SCOPE_SEED_WITH_ACTION as Uppercase<\n    string & A\n  >]: ScopeConstantNode<typeof SCOPE_SEED> & { ALL: Scope };\n};\n\nconst buildScopeConstants = (): ScopeConstantType => {\n  const result = {} as Partial<ScopeConstantType>;\n\n  const processObject = (\n    // biome-ignore lint/suspicious/noExplicitAny: ignore\n    obj: Record<string, any>,\n    path: string[] = [],\n    // biome-ignore lint/suspicious/noExplicitAny: ignore\n    resultObj: Record<string, any>,\n  ) => {\n    for (const [key, value] of Object.entries(obj)) {\n      const upperKey = key.toUpperCase();\n      const currentPath = [...path, key];\n      const scopePath = currentPath.join(':');\n\n      if (value == null) {\n        continue; // Changed from 'return' to 'continue' to match the loop behavior\n      }\n\n      if (typeof value === 'object' && Object.keys(value).length === 0) {\n        resultObj[upperKey] = `${scopePath}` as Scope;\n      } else if (typeof value === 'object') {\n        resultObj[upperKey] = {\n          ALL: `${scopePath}:${ALL_SIGN}` as Scope,\n        };\n\n        processObject(value, currentPath, resultObj[upperKey]);\n      }\n    }\n  };\n  processObject(SCOPE_SEED_WITH_ACTION, [], result);\n\n  return result as ScopeConstantType;\n};\n\nexport const SCOPE = buildScopeConstants();\n"],"names":["SCOPE_SEED_ADMIN","SCOPE_SEED_USER","SCOPE_SEED","ACTION","ALL_SIGN","SCOPE_SEED_WITH_ACTION","acc","action","buildScopeConstants","result","processObject","obj","path","resultObj","key","value","upperKey","currentPath","scopePath","SCOPE"],"mappings":"AAQA,MAAMA,IAAmB;AAAA,EACvB,OAAO;AAAA,IACL,KAAK,CAAC;AAAA,IACN,KAAK,CAAC;AAAA,IACN,UAAU,CAAC;AAAA,IACX,UAAU,CAAC;AAAA,IACX,WAAW,CAAC;AAAA,IACZ,aAAa,CAAC;AAAA,IACd,aAAa,CAAC;AAAA,IACd,eAAe,CAAC;AAAA,IAChB,uBAAuB,CAAC;AAAA,IACxB,mBAAmB,CAAC;AAAA,IACpB,0BAA0B,CAAC;AAAA,IAC3B,iBAAiB,CAAC;AAAA,IAClB,uBAAuB,CAAC;AAAA,IACxB,WAAW,CAAC;AAAA,IACZ,QAAQ,CAAC;AAAA,IACT,gBAAgB,CAAC;AAAA,IACjB,kBAAkB,CAAA;AAAA,EAAC;AAEvB,GAEMC,IAAkB;AAAA,EACtB,eAAe;AAAA,IACb,MAAM,CAAC;AAAA,IACP,kBAAkB,CAAC;AAAA,IACnB,UAAU,CAAC;AAAA,IACX,KAAK;AAAA,MACH,WAAW,CAAC;AAAA,MACZ,cAAc,CAAA;AAAA,IAChB;AAAA,IACA,qBAAqB,CAAC;AAAA,IACtB,OAAO,CAAA;AAAA,EACT;AAAA,EACA,UAAU;AAAA,IACR,cAAc,CAAC;AAAA,IACf,MAAM,CAAC;AAAA,IACP,YAAY,CAAC;AAAA,IACb,UAAU,CAAC;AAAA,IACX,YAAY,CAAC;AAAA,IACb,kBAAkB,CAAA;AAAA,EAAC;AAEvB,GAEMC,IAAa;AAAA,EACjB,GAAGF;AAAA,EACH,GAAGC;AACL,GAEaE,IAAS;AAAA,EACpB,MAAM;AAAA,EACN,OAAO;AACT,GAGaC,IAAW,KAElBC,IAAyB,OAAO,OAAOF,CAAM,EAAE;AAAA,EACnD,CAACG,GAAKC,OACJD,EAAIC,CAAM,IAAIL,GACPI;AAAA,EAET,CAAA;AACF,GAmCME,IAAsB,MAAyB;AACnD,QAAMC,IAAS,CAAC,GAEVC,IAAgB,CAEpBC,GACAC,IAAiB,CAAA,GAEjBC,MACG;AACH,eAAW,CAACC,GAAKC,CAAK,KAAK,OAAO,QAAQJ,CAAG,GAAG;AACxC,YAAAK,IAAWF,EAAI,YAAY,GAC3BG,IAAc,CAAC,GAAGL,GAAME,CAAG,GAC3BI,IAAYD,EAAY,KAAK,GAAG;AAEtC,MAAIF,KAAS,SAIT,OAAOA,KAAU,YAAY,OAAO,KAAKA,CAAK,EAAE,WAAW,IACnDF,EAAAG,CAAQ,IAAI,GAAGE,CAAS,KACzB,OAAOH,KAAU,aAC1BF,EAAUG,CAAQ,IAAI;AAAA,QACpB,KAAK,GAAGE,CAAS,IAAId,CAAQ;AAAA,MAC/B,GAEAM,EAAcK,GAAOE,GAAaJ,EAAUG,CAAQ,CAAC;AAAA,IACvD;AAAA,EAEJ;AACc,SAAAN,EAAAL,GAAwB,CAAC,GAAGI,CAAM,GAEzCA;AACT,GAEaU,IAAQX,EAAoB;"}