{"version":3,"file":"common.js","sources":["../../src/interfaces/common.ts"],"sourcesContent":["/*\n * Common types and interfaces\n */\n\nimport type { Types } from 'mongoose';\n\nimport { isValidObjectId } from '../utils/objectid-utils';\n\ntype ObjectId = Types.ObjectId;\n\n// Foreign key field\nexport type Ref<T> = string | ObjectId | (T & { _id: string | ObjectId });\n\nexport type Nullable<T> = T | null | undefined;\n\nexport const isRef = <T>(obj: unknown): obj is Ref<T> => {\n  return (\n    obj != null &&\n    ((typeof obj === 'string' && isValidObjectId(obj)) ||\n      (typeof obj === 'object' &&\n        '_bsontype' in obj &&\n        obj._bsontype === 'ObjectID') ||\n      (typeof obj === 'object' && '_id' in obj))\n  );\n};\n\nexport const isPopulated = <T>(\n  ref: Ref<T>,\n): ref is T & { _id: string | ObjectId } => {\n  return (\n    ref != null &&\n    typeof ref !== 'string' &&\n    !('_bsontype' in ref && ref._bsontype === 'ObjectID')\n  );\n};\n\nexport const getIdForRef = <T>(ref: Ref<T>): string | ObjectId => {\n  return isPopulated(ref) ? ref._id : ref;\n};\n\nexport const getIdStringForRef = <T>(ref: Ref<T>): string => {\n  return getIdForRef(ref).toString();\n};\n"],"names":["isRef","obj","isValidObjectId","isPopulated","ref","getIdForRef","getIdStringForRef"],"mappings":";AAea,MAAAA,IAAQ,CAAIC,MAErBA,KAAO,SACL,OAAOA,KAAQ,YAAYC,EAAgBD,CAAG,KAC7C,OAAOA,KAAQ,YACd,eAAeA,KACfA,EAAI,cAAc,cACnB,OAAOA,KAAQ,YAAY,SAASA,IAI9BE,IAAc,CACzBC,MAGEA,KAAO,QACP,OAAOA,KAAQ,YACf,EAAE,eAAeA,KAAOA,EAAI,cAAc,aAIjCC,IAAc,CAAID,MACtBD,EAAYC,CAAG,IAAIA,EAAI,MAAMA,GAGzBE,IAAoB,CAAIF,MAC5BC,EAAYD,CAAG,EAAE,SAAS;"}