{"version":3,"file":"user-serializer.js","sources":["../../../src/models/serializers/user-serializer.ts"],"sourcesContent":["import { Document } from 'mongoose';\n\nimport { isPopulated, isRef, type Ref } from '../../interfaces/common';\nimport type { IUser } from '../../interfaces/user';\n\nexport type IUserSerializedSecurely<U extends IUser> = Omit<\n  U,\n  'password' | 'apiToken' | 'email'\n> & { email?: string };\n\nexport const omitInsecureAttributes = <U extends IUser>(\n  user: U,\n): IUserSerializedSecurely<U> => {\n  const leanDoc = user instanceof Document ? user.toObject<U>() : user;\n\n  const {\n    // biome-ignore lint/correctness/noUnusedVariables: ignore\n    password,\n    // biome-ignore lint/correctness/noUnusedVariables: ignore\n    apiToken,\n    email,\n    ...rest\n  } = leanDoc;\n\n  const secureUser: IUserSerializedSecurely<U> = rest;\n\n  // omit email\n  if (secureUser.isEmailPublished) {\n    secureUser.email = email;\n  }\n\n  return secureUser;\n};\n\nexport function serializeUserSecurely<U extends IUser>(\n  user?: U,\n): IUserSerializedSecurely<U>;\nexport function serializeUserSecurely<U extends IUser>(\n  user?: Ref<U>,\n): Ref<IUserSerializedSecurely<U>>;\nexport function serializeUserSecurely<U extends IUser>(\n  user?: U | Ref<U>,\n): undefined | IUserSerializedSecurely<U> | Ref<IUserSerializedSecurely<U>> {\n  if (user == null) return user;\n\n  if (isRef(user) && !isPopulated(user)) return user;\n\n  return omitInsecureAttributes(user);\n}\n"],"names":["omitInsecureAttributes","user","leanDoc","Document","password","apiToken","email","rest","secureUser","serializeUserSecurely","isRef","isPopulated"],"mappings":";;AAUa,MAAAA,IAAyB,CACpCC,MAC+B;AAC/B,QAAMC,IAAUD,aAAgBE,IAAWF,EAAK,SAAgB,IAAAA,GAE1D;AAAA;AAAA,IAEJ,UAAAG;AAAA;AAAA,IAEA,UAAAC;AAAA,IACA,OAAAC;AAAA,IACA,GAAGC;AAAA,EAAA,IACDL,GAEEM,IAAyCD;AAG/C,SAAIC,EAAW,qBACbA,EAAW,QAAQF,IAGdE;AACT;AAQO,SAASC,EACdR,GAC0E;AAG1E,SAFIA,KAAQ,QAERS,EAAMT,CAAI,KAAK,CAACU,EAAYV,CAAI,IAAUA,IAEvCD,EAAuBC,CAAI;AACpC;"}